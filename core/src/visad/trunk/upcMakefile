include macros.make

JARFILE		= visad-core.jar
JAR_CLASSES	= *.class data/*.class

SUBDIR_TARGETS	=  \
		  util/default   util/all   util/classes   util/jar \
		      util/ftpable_subjars util/clean \
		  java3d/default java3d/all java3d/classes java3d/jar \
		      java3d/ftpable_subjars java3d/clean \
		  java2d/default java2d/all java2d/classes java2d/jar \
		      java2d/ftpable_subjars java2d/clean \
		  data/default   data/all   data/classes   data/jar \
		      data/ftpable_subjars data/clean \
		  ss/default   ss/all   ss/classes   ss/jar \
		      ss/ftpable_subjars ss/clean \
		  examples/default   examples/all   examples/classes \
		    examples/jar examples/ftpable_subjars examples/clean

default:	classes
default:	util/default \
		java3d/default \
		java2d/default \
		data/default \
		ss/default \
		examples/default
all:		util/all \
		java3d/all \
		java2d/all \
		data/all \
		ss/all \
		examples/all
install:	jar doc
ftp:		ftpable_jars ftpable_docs ftpable_srcs
clean:		util/clean \
		java3d/clean \
		java2d/clean \
		data/clean \
		ss/clean \
		examples/clean

ftpable_jars:	ftpable_jar ftpable_subjars
ftpable_jar:
	@version=`cat VERSION`; \
	  $(MAKE) $(FTPDIR)/visad-$$version.jar VERSION=$$version
ftpable_subjars:	util/ftpable_subjars \
			java3d/ftpable_subjars \
			java2d/ftpable_subjars \
			data/ftpable_subjars

ftpable_docs:
ftpable_srcs:

docs:		doc
doc:		javadocs

javadocs:	$(DOCDIR) FORCE
	$(JAVADOC) -J-mx64m -d $(DOCDIR) -overview overview.html \
	    -title 'VisAD API Specification' \
	    visad \
	    visad.data \
	    visad.data.fits \
	    visad.data.gif \
	    visad.data.hdfeos \
	    visad.data.hdfeos.hdfeosc \
	    visad.data.netcdf \
	    visad.data.netcdf.in \
	    visad.data.netcdf.out \
	    visad.data.netcdf.units \
	    visad.data.vis5d \
	    visad.java2d \
	    visad.java3d \
	    visad.paoloa \
	    visad.ss \
	    visad.util

polardocs:	$(DOCDIR) FORCE
	$(POLARDOC) -r -d $(DOCDIR) .

jar:		visad.jar
visad.jar:	#all
	jarfile=`pwd`/$@; { \
	    cd ..; \
	    $(JAR) cf $$jarfile `find visad -name \*.class -print` && \
	    cd /upc/share/ucar/classes && \
	    $(JAR) uf $$jarfile `find ucar -name \*.class -print`; \
	} || { rm -f $$jarfile; exit 1; }

$(FTPDIR)/visad-$(VERSION).jar:	$(JARDIR)/visad.jar $(FTPDIR)
	cp $(JARDIR)/visad.jar $@

include rules.make
